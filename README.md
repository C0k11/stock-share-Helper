# QuantAI - 智能量化投顾助手

> 基于多模态AI的个人证券投资助手，提供ETF组合策略建议、风险预警与可解释决策。

## 项目定位

**不是"保证赚钱"的黑箱，而是"风险约束下可解释建议"的智能助手。**

核心能力：
- **策略建议**：每日输出目标仓位、入场/离场条件、止损止盈
- **风险预警**：波动上升、回撤预警、相关性飙升检测
- **新闻理解**：LLM结构化新闻事件，解释"为什么建议减仓"
- **历史分析**：分析历史走势+新闻，识别影响股市的关键因素
- **个性化**：根据用户风险偏好（保守/平衡/进取）调整仓位

---

## MVP定义（第1版）

| 维度 | 决定 |
|------|------|
| **市场** | 美股ETF优先，港股ETF第二阶段 |
| **标的池** | TLT, IEF, GLD, SPY, QQQ, SHY |
| **频率** | 日频（收盘后生成建议），盘中作为二期增强 |
| **输出** | 策略建议/提醒 + 模拟组合收益曲线 |
| **风险档位** | 保守(5%回撤) / 平衡(10%) / 进取(20%) |
| **技术栈** | Python + 本地LLM微调(4090) |
| **数据源** | 免费源先跑通（yfinance/Stooq/NewsAPI） |

---

## 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户交互层                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │  Web前端    │  │  API接口    │  │  提醒/告警（可选）       │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────────┐
│                         决策引擎层                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │ 策略模块    │  │ 风控模块    │  │  LLM解释模块            │  │
│  │ (趋势/动量) │  │ (止损/回撤) │  │  (新闻→建议原因)        │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────────┐
│                         特征与信号层                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │ 技术因子    │  │ 风险状态    │  │  新闻因子               │  │
│  │ (MA/动量)   │  │ (Regime)    │  │  (事件/情绪)            │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────────┐
│                         数据层                                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │ 行情数据    │  │ 宏观指标    │  │  新闻数据               │  │
│  │ (OHLCV)     │  │ (VIX等)     │  │  (RSS/API)              │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
```


## 项目结构

```
Stock/
├── README.md                 # 本文件
├── requirements.txt          # Python依赖
├── .gitignore               # Git忽略规则
├── config/                  # 配置文件
│   ├── settings.yaml        # 全局配置
│   ├── symbols.yaml         # 标的池配置
│   └── risk_profiles.yaml   # 风险档位配置
│
├── data/                    # 数据目录（不提交到git）
│   ├── raw/                 # 原始数据
│   ├── processed/           # 处理后数据
│   └── cache/               # 缓存
│
├── src/                     # 源代码
│   ├── __init__.py
│   ├── data/                # 数据层
│   │   ├── __init__.py
│   │   ├── fetcher.py       # 数据抓取（行情/新闻）
│   │   ├── calendar.py      # 交易日历
│   │   └── storage.py       # 数据存储
│   │
│   ├── features/            # 特征工程
│   │   ├── __init__.py
│   │   ├── technical.py     # 技术因子（MA/动量/波动）
│   │   ├── regime.py        # 风险状态检测
│   │   └── news.py          # 新闻因子（事件/情绪）
│   │
│   ├── strategy/            # 策略模块
│   │   ├── __init__.py
│   │   ├── signals.py       # 信号生成
│   │   ├── position.py      # 仓位计算（目标波动/风险档位）
│   │   └── rules.py         # 交易规则（入场/离场/止损）
│   │
│   ├── risk/                # 风控模块
│   │   ├── __init__.py
│   │   ├── drawdown.py      # 回撤控制
│   │   ├── volatility.py    # 波动率目标
│   │   └── alerts.py        # 风险预警
│   │
│   ├── backtest/            # 回测模块
│   │   ├── __init__.py
│   │   ├── engine.py        # 回测引擎
│   │   ├── costs.py         # 成本模型（佣金/滑点）
│   │   └── metrics.py       # 绩效指标（Sharpe/回撤等）
│   │
│   ├── llm/                 # LLM模块
│   │   ├── __init__.py
│   │   ├── news_parser.py   # 新闻结构化
│   │   ├── explainer.py     # 决策解释生成
│   │   └── finetune/        # 微调相关
│   │       ├── dataset.py   # 数据集构建
│   │       ├── train.py     # 微调训练
│   │       └── inference.py # 推理服务
│   │
│   └── api/                 # API接口
│       ├── __init__.py
│       ├── main.py          # FastAPI入口
│       └── schemas.py       # 数据模型
│
├── notebooks/               # Jupyter研究笔记
│   ├── 01_data_exploration.ipynb
│   ├── 02_feature_analysis.ipynb
│   ├── 03_strategy_backtest.ipynb
│   └── 04_llm_experiments.ipynb
│
├── scripts/                 # 脚本
│   ├── download_data.py     # 下载历史数据
│   ├── daily_update.py      # 每日更新
│   └── run_backtest.py      # 运行回测
│
├── models/                  # 模型文件（不提交到git）
│   ├── ml/                  # ML模型（LightGBM等）
│   └── llm/                 # LLM模型/LoRA权重
│
├── tests/                   # 测试
│   ├── test_data.py
│   ├── test_features.py
│   ├── test_strategy.py
│   └── test_backtest.py
│
└── web/                     # 前端（未来）
    └── ...
```


## 迭代路线图

### Phase 1: 数据与回测基础（Week 1-2）
- [ ] 数据抓取模块（yfinance/Stooq）
- [ ] 交易日历与时区处理
- [ ] 技术因子计算（MA/动量/波动率）
- [ ] 回测引擎（成本/滑点/再平衡）
- [ ] 基础绩效指标

### Phase 2: 策略MVP（Week 3-4）
- [ ] 风险状态检测（Regime: Risk-On/Off/Transition）
- [ ] 目标波动仓位计算
- [ ] 趋势/动量信号
- [ ] 回撤保护规则
- [ ] Walk-forward验证

### Phase 3: LLM微调（Week 5-6）
- [ ] 新闻数据收集与标注
- [ ] 微调数据集构建（事件分类/情绪/影响方向）
- [ ] LoRA微调Qwen2.5-7B
- [ ] 新闻结构化推理
- [ ] 决策解释生成

### Phase 4: 产品集成（Week 7-8）
- [ ] 用户风险档位配置
- [ ] 每日建议生成流程
- [ ] 模拟组合跟踪
- [ ] API接口
- [ ] 简单Web展示

### Phase 5: 增强（后续）
- [ ] 盘中信号与触发器
- [ ] 港股ETF支持
- [ ] ML预测模型（LightGBM）
- [ ] 更多新闻源与因子
- [ ] A股ETF支持

---

## 输出协议

每日为每个ETF（及组合）输出：

```json
{
  "date": "2024-01-15",
  "symbol": "SPY",
  "recommendation": {
    "action": "减仓",
    "target_position": 0.3,
    "current_position": 0.5,
    "entry_condition": null,
    "exit_condition": "价格跌破$470立即执行",
    "stop_loss": "$465",
    "take_profit": null
  },
  "risk_alerts": [
    {"type": "volatility_up", "severity": "medium", "message": "VIX升至22，波动上升"},
    {"type": "drawdown_warning", "severity": "low", "message": "组合回撤3.2%，接近保守档位阈值"}
  ],
  "explanation": {
    "technical": "SPY跌破20日均线，短期趋势转弱",
    "regime": "风险状态从Risk-On转为Transition",
    "news": "美联储会议纪要显示可能维持高利率更长时间，债券承压但避险情绪利好黄金"
  },
  "confidence": 0.72
}
```

---

## 风险档位配置

| 档位 | 最大回撤容忍 | 目标年化波动 | 单标的上限 | 现金下限 |
|------|-------------|-------------|-----------|---------|
| 保守 | 5% | 6% | 25% | 30% |
| 平衡 | 10% | 10% | 35% | 15% |
| 进取 | 20% | 15% | 50% | 5% |

---

## 环境配置

### 硬件要求
- **最低**：8GB内存，无GPU（仅ML模型+API调用LLM）
- **推荐**：16GB内存，8GB显存（本地LLM推理）
- **当前配置**：RTX 4090 + AMD 7950X3D（支持LLM微调）

### 安装

```bash
# 克隆项目
git clone https://github.com/YOUR_USERNAME/Stock.git
cd Stock

# 创建虚拟环境
python -m venv venv
venv\Scripts\activate  # Windows
# source venv/bin/activate  # Linux/Mac

# 安装依赖
pip install -r requirements.txt

# 下载历史数据
python scripts/download_data.py

# 运行回测
python scripts/run_backtest.py
```

---

## 免责声明

**本项目仅供学习研究，不构成任何投资建议。**

- 历史业绩不代表未来表现
- 所有策略建议仅供参考，投资决策需自行判断
- 使用本系统产生的任何损失由用户自行承担

---

## License

MIT License